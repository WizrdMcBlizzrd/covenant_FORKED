<section
  data-testid="inscription-page"
  data-controller="inscription"
  data-action="wallet:connected@window->inscription#onWalletConnected wallet:disconnected@window->inscription#onWalletDisconnected"
  data-inscription-price-value="<%= checkout.priceSats %>"
  data-inscription-inscription-metadata-value="<%= JSON.stringify(inscription.metadata) %>"
  data-inscription-payment-address-value="<%= config.payment_address %>"
>
  <div class="page-container torn-paper">
  <div class="section">
    <div class="detail-layout">
      <!-- Left: Media (Polaroid style) -->
      <div class="detail-media-window">
        <div class="detail-image">
          <div class="polaroid" style="--rot: -2deg;">
            <div class="tape tape-tl"></div>
            <div class="tape tape-tr"></div>
            <div class="detail-media" data-testid="media" data-controller="image">
              <div class="inscription-skeleton" data-image-target="skeleton"></div>
              <% if (inscription.isImage) { %>
                <img
                  src="<%= inscription.contentUrl %>"
                  alt="<%= title %>"
                  loading="eager"
                  decoding="async"
                  class="opacity-0 transition-opacity duration-300"
                  data-image-target="img"
                  data-action="load->image#loaded error->image#error"
                  data-testid="inscription-media-img"
                />
              <% } else { %>
                <iframe
                  src="<%= inscription.previewUrl %>"
                  class="pointer-events-none opacity-0 transition-opacity duration-300"
                  allow="accelerometer; gyroscope"
                  data-image-target="media"
                  data-action="load->image#loaded error->image#error"
                  data-testid="inscription-media-iframe"
                ></iframe>
              <% } %>
            </div>
            <div class="polaroid-caption"><%= title %></div>
          </div>
        </div>
      </div>

      <!-- Right: Sidebar -->
      <div class="detail-sidebar">
        <!-- Info Window -->
        <div class="detail-info-window">
          <div class="detail-title">
            <% const titleWords = title.split(' '); %>
            <% titleWords.slice(0, 3).forEach((word, i) => { %>
              <% const cutoutStyles = ['cutout cutout-black', 'cutout', 'cutout cutout-yellow']; %>
              <% const fontStyles = ["'Bebas Neue'", "'Playfair Display'", "'Anton'"]; %>
              <span class="<%= cutoutStyles[i % cutoutStyles.length] %>" style="font-family: <%= fontStyles[i % fontStyles.length] %>; --rot: <%= ((i % 2 === 0 ? -1 : 1) * (2 + i % 2)) %>deg;"><%= word %></span>
            <% }); %>
          </div>
          <div class="detail-number" data-testid="page-title">Inscription #<%= new Intl.NumberFormat('en-US').format(inscription.number) %></div>
          <div class="detail-collection">From: <a href="/<%= encodeURIComponent(config.slug) %>"><%= config.title %></a></div>
        </div>

        <!-- Properties (Pinned Note) -->
        <div class="detail-meta" data-testid="details">
          <div class="meta-row" data-testid="detail-id">
            <span class="meta-label">Inscription ID</span>
            <span class="meta-value"><a href="https://ordinals.com/inscription/<%= encodeURIComponent(inscription.id) %>" target="_blank" rel="noopener" data-testid="detail-id-link"><%= inscription.id.substring(0, 12) %>...</a></span>
          </div>
          <div class="meta-row" data-testid="detail-number">
            <span class="meta-label">Inscription #</span>
            <span class="meta-value"><a href="https://ordinals.com/inscription/<%= encodeURIComponent(inscription.id) %>" target="_blank" rel="noopener" data-testid="detail-number-link"><%= new Intl.NumberFormat('en-US').format(inscription.number) %></a></span>
          </div>
          <div class="meta-row">
            <span class="meta-label">Content Type</span>
            <span class="meta-value"><%= inscription.contentType || 'Unknown' %></span>
          </div>
          <div class="meta-row" data-testid="detail-sat">
            <span class="meta-label">Sat</span>
            <span class="meta-value"><a href="https://ordinals.com/sat/<%= encodeURIComponent(inscription.sat) %>" target="_blank" rel="noopener" data-testid="detail-sat-link"><%= inscription.sat %></a></span>
          </div>
          <div class="meta-row" data-testid="detail-inscribed">
            <span class="meta-label">Created</span>
            <% const inscribedHuman = new Date(inscription.timestamp * 1000).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric', timeZone: 'UTC' }) %>
            <span class="meta-value" data-testid="detail-inscribed-value"><%= inscribedHuman %></span>
          </div>
          <% if (inscription.charmIcons.length > 0) { %>
            <div class="meta-row" data-testid="detail-charms">
              <span class="meta-label">Charms</span>
              <span class="meta-value" data-testid="detail-charms-icons" style="font-size: 18px;">
                <% inscription.charmIcons.forEach((icon) => { %>
                  <span><%= icon %></span>
                <% }) %>
              </span>
            </div>
          <% } %>
          <% if (inscription.parents.length > 0) { %>
            <div class="meta-row" data-testid="detail-parents">
              <span class="meta-label">Parents</span>
              <span class="meta-value" data-testid="detail-parents-list">
                <% inscription.parents.forEach((parentId) => { %>
                  <a href="https://ordinals.com/inscription/<%= encodeURIComponent(parentId) %>" target="_blank" rel="noopener" title="<%= parentId %>" data-testid="detail-parent-link"><%= parentId.substring(0, 12) %>...</a>
                <% }) %>
              </span>
            </div>
          <% } %>
        </div>

        <!-- Purchase Window -->
        <div class="purchase-panel">
          <% if (order.status === 'pending' || order.status === 'confirmed') { %>
            <%- include('partials/order', { order }) %>
          <% } else { %>
            <div data-testid="purchase-panel">
              <div class="price-display">
                <div class="price-label">YOUR RANSOM DEMAND</div>
                <span class="price-amount" data-testid="price-sats"><%= formatSats(checkout.priceSats).replace(' sats', '') %><span class="sats"> sats</span></span>
                <div class="purchase-usd hidden" data-usd-sats="<%= checkout.priceSats %>"></div>
              </div>

              <form method="post" data-testid="buy-form" data-inscription-target="form" style="margin-top: 20px;">
                <% if ((config.optional_payments ?? []).length > 0) { %>
                  <div class="optional-payments" data-testid="optional-payments">
                    <div class="optional-payments-label">Additional Options</div>
                    <% config.optional_payments.forEach((payment, index) => { %>
                      <label class="optional-payment" data-testid="optional-payment">
                        <input type="checkbox" data-inscription-target="optionalPayment" data-payment='<%= JSON.stringify(payment) %>' data-action="inscription#calculateCost" />
                        <div class="optional-payment-title"><%= payment.title %></div>
                        <span class="optional-payment-amount"><%= formatSats(payment.amount) %></span>
                        <div class="optional-payment-desc"><%= payment.description %></div>
                      </label>
                    <% }) %>
                  </div>
                <% } %>

                <div class="fees-section" data-testid="fees" data-inscription-target="fees">
                  <div class="fee-row">
                    <span class="label">Network Fee:</span>
                    <span class="value" data-inscription-target="fee">-</span>
                  </div>
                  <div class="fee-row">
                    <span class="label">Fee Rate:</span>
                    <span class="value" data-inscription-target="feeRate">-</span>
                  </div>
                  <div class="fee-row total">
                    <span class="label">Total:</span>
                    <span class="value" data-inscription-target="total">-</span>
                  </div>
                </div>

                <div style="margin-top: 20px;">
                  <button
                    class="btn-buy hide-on-connected"
                    type="button"
                    data-inscription-target="connectButton"
                    data-action="wallet#select"
                  >
                    <span>CONNECT WALLET</span>
                  </button>

                  <button
                    class="btn-buy show-on-connected"
                    type="button"
                    data-inscription-target="prepareButton"
                    data-action="click->inscription#prepare"
                  >
                    <span style="display: inline-flex; align-items: center; justify-content: center; gap: 8px;">
                      <span data-inscription-target="prepareSpinner" class="button-spinner button-spinner-hidden"></span>
                      <span data-inscription-target="prepareLabel">PAY THE RANSOM</span>
                    </span>
                  </button>

                  <button
                    class="hidden btn-buy"
                    type="button"
                    data-testid="buy-button"
                    data-inscription-target="buyButton"
                    data-action="click->inscription#buy"
                  >
                    <span style="display: inline-flex; align-items: center; justify-content: center; gap: 8px;">
                      <span data-inscription-target="buySpinner" class="button-spinner button-spinner-hidden"></span>
                      <span data-inscription-target="buyLabel">PAY THE RANSOM</span>
                    </span>
                  </button>
                </div>
              </form>

              <div class="hidden message message-success" data-inscription-target="successPanel" data-testid="buy-success">
                <div class="message-title">RANSOM PAID // COMPLETE</div>
                <a class="message-link" target="_blank" rel="noopener" data-inscription-target="successLink" href="">View on mempool.space</a>
              </div>

              <div class="hidden message message-error" data-inscription-target="errorPanel" data-testid="buy-client-error">
                <div class="message-title">ERROR // FAILED</div>
                <div class="message-link" data-inscription-target="errorMessage"></div>
              </div>

              <p class="handwritten" style="margin-top: 15px; font-size: 14px; text-align: center;">
                No funny business...
              </p>
            </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>
  </div>
</section>
